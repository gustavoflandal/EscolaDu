import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
  console.log('üå± Iniciando seed de Objetivos de Aprendizagem...\n');

  // Buscar programas de ensino existentes
  const programas = await prisma.programaEnsino.findMany({
    where: { active: true },
    include: { disciplina: true },
  });

  if (programas.length === 0) {
    console.log('‚ö†Ô∏è  Nenhum programa de ensino encontrado. Execute o seed de programas primeiro.');
    return;
  }

  console.log(`üìö Encontrados ${programas.length} programas de ensino\n`);

  const objetivosData = [];

  // ============================================
  // PORTUGU√äS - 1¬∫ ANO
  // ============================================
  const port1ano = programas.find(p => p.codigo === 'PORT-1ANO-2025');
  if (port1ano) {
    console.log('üìù Criando objetivos de Portugu√™s - 1¬∫ Ano...');
    objetivosData.push(
      {
        codigoBNCC: 'EF01LP01',
        descricao: 'Reconhecer que textos s√£o lidos e escritos da esquerda para a direita e de cima para baixo da p√°gina.',
        programaEnsinoId: port1ano.id,
        ordem: 1,
        competencia: 'Compreender as conven√ß√µes da escrita',
        habilidade: 'Reconhecimento da dire√ß√£o da escrita',
      },
      {
        codigoBNCC: 'EF01LP02',
        descricao: 'Escrever, espontaneamente ou por ditado, palavras e frases de forma alfab√©tica ‚Äì usando letras/grafemas que representem fonemas.',
        programaEnsinoId: port1ano.id,
        ordem: 2,
        competencia: 'Apropriar-se do sistema alfab√©tico de escrita',
        habilidade: 'Correspond√™ncia fonema-grafema',
      },
      {
        codigoBNCC: 'EF01LP03',
        descricao: 'Observar escritas convencionais, comparando-as √†s suas produ√ß√µes escritas, percebendo semelhan√ßas e diferen√ßas.',
        programaEnsinoId: port1ano.id,
        ordem: 3,
        competencia: 'Desenvolver consci√™ncia ortogr√°fica',
        habilidade: 'An√°lise e reflex√£o sobre a escrita',
      },
      {
        codigoBNCC: 'EF01LP04',
        descricao: 'Distinguir as letras do alfabeto de outros sinais gr√°ficos.',
        programaEnsinoId: port1ano.id,
        ordem: 4,
        competencia: 'Conhecer o alfabeto',
        habilidade: 'Identifica√ß√£o de letras',
      },
      {
        codigoBNCC: 'EF01LP05',
        descricao: 'Reconhecer o sistema de escrita alfab√©tica como representa√ß√£o dos sons da fala.',
        programaEnsinoId: port1ano.id,
        ordem: 5,
        competencia: 'Compreender o princ√≠pio alfab√©tico',
        habilidade: 'Consci√™ncia fonol√≥gica',
      },
    );
  }

  // ============================================
  // MATEM√ÅTICA - 1¬∫ ANO
  // ============================================
  const mat1ano = programas.find(p => p.codigo === 'MAT-1ANO-2025');
  if (mat1ano) {
    console.log('üìù Criando objetivos de Matem√°tica - 1¬∫ Ano...');
    objetivosData.push(
      {
        codigoBNCC: 'EF01MA01',
        descricao: 'Utilizar n√∫meros naturais como indicadores de quantidade ou de ordem em diferentes situa√ß√µes cotidianas e reconhecer situa√ß√µes em que os n√∫meros n√£o indicam contagem nem ordem, mas sim c√≥digo de identifica√ß√£o.',
        programaEnsinoId: mat1ano.id,
        ordem: 1,
        competencia: 'Compreender e utilizar o sistema de numera√ß√£o decimal',
        habilidade: 'Fun√ß√£o social dos n√∫meros',
      },
      {
        codigoBNCC: 'EF01MA02',
        descricao: 'Contar de maneira exata ou aproximada, utilizando diferentes estrat√©gias como o pareamento e outros agrupamentos.',
        programaEnsinoId: mat1ano.id,
        ordem: 2,
        competencia: 'Desenvolver o conceito de n√∫mero',
        habilidade: 'Contagem e quantifica√ß√£o',
      },
      {
        codigoBNCC: 'EF01MA03',
        descricao: 'Estimar e comparar quantidades de objetos de dois conjuntos (em torno de 20 elementos), por estimativa e/ou por correspond√™ncia (um a um, dois a dois) para indicar "tem mais", "tem menos" ou "tem a mesma quantidade".',
        programaEnsinoId: mat1ano.id,
        ordem: 3,
        competencia: 'Estabelecer rela√ß√µes de quantidade',
        habilidade: 'Compara√ß√£o de quantidades',
      },
      {
        codigoBNCC: 'EF01MA04',
        descricao: 'Contar a quantidade de objetos de cole√ß√µes at√© 100 unidades e apresentar o resultado por registros verbais e simb√≥licos, em situa√ß√µes de seu interesse, como jogos, brincadeiras, materiais da sala de aula, entre outros.',
        programaEnsinoId: mat1ano.id,
        ordem: 4,
        competencia: 'Ampliar a sequ√™ncia num√©rica',
        habilidade: 'Contagem at√© 100',
      },
      {
        codigoBNCC: 'EF01MA05',
        descricao: 'Comparar n√∫meros naturais de at√© duas ordens em situa√ß√µes cotidianas, com e sem suporte da reta num√©rica.',
        programaEnsinoId: mat1ano.id,
        ordem: 5,
        competencia: 'Ordenar n√∫meros naturais',
        habilidade: 'Compara√ß√£o de n√∫meros',
      },
      {
        codigoBNCC: 'EF01MA06',
        descricao: 'Construir fatos b√°sicos da adi√ß√£o e utiliz√°-los em procedimentos de c√°lculo para resolver problemas.',
        programaEnsinoId: mat1ano.id,
        ordem: 6,
        competencia: 'Compreender e resolver opera√ß√µes de adi√ß√£o',
        habilidade: 'Fatos b√°sicos da adi√ß√£o',
      },
    );
  }

  // ============================================
  // CI√äNCIAS - 1¬∫ ANO
  // ============================================
  const cien1ano = programas.find(p => p.codigo === 'CIEN-1ANO-2025');
  if (cien1ano) {
    console.log('üìù Criando objetivos de Ci√™ncias - 1¬∫ Ano...');
    objetivosData.push(
      {
        codigoBNCC: 'EF01CI01',
        descricao: 'Comparar caracter√≠sticas de diferentes materiais presentes em objetos de uso cotidiano, discutindo sua origem, os modos como s√£o descartados e como podem ser usados de forma mais consciente.',
        programaEnsinoId: cien1ano.id,
        ordem: 1,
        competencia: 'Compreender as propriedades dos materiais',
        habilidade: 'Identifica√ß√£o e classifica√ß√£o de materiais',
      },
      {
        codigoBNCC: 'EF01CI02',
        descricao: 'Localizar, nomear e representar graficamente (por meio de desenhos) partes do corpo humano e explicar suas fun√ß√µes.',
        programaEnsinoId: cien1ano.id,
        ordem: 2,
        competencia: 'Conhecer o corpo humano',
        habilidade: 'Partes e fun√ß√µes do corpo',
      },
      {
        codigoBNCC: 'EF01CI03',
        descricao: 'Discutir as raz√µes pelas quais os h√°bitos de higiene do corpo (lavar as m√£os antes de comer, escovar os dentes, limpar os olhos, o nariz e as orelhas etc.) s√£o necess√°rios para a manuten√ß√£o da sa√∫de.',
        programaEnsinoId: cien1ano.id,
        ordem: 3,
        competencia: 'Desenvolver h√°bitos saud√°veis',
        habilidade: 'Higiene e sa√∫de',
      },
      {
        codigoBNCC: 'EF01CI04',
        descricao: 'Comparar caracter√≠sticas f√≠sicas entre os colegas, reconhecendo a diversidade e a import√¢ncia da valoriza√ß√£o, do acolhimento e do respeito √†s diferen√ßas.',
        programaEnsinoId: cien1ano.id,
        ordem: 4,
        competencia: 'Respeitar a diversidade humana',
        habilidade: 'Caracter√≠sticas f√≠sicas e diversidade',
      },
    );
  }

  // ============================================
  // PORTUGU√äS - 2¬∫ ANO
  // ============================================
  const port2ano = programas.find(p => p.codigo === 'PORT-2ANO-2025');
  if (port2ano) {
    console.log('üìù Criando objetivos de Portugu√™s - 2¬∫ Ano...');
    objetivosData.push(
      {
        codigoBNCC: 'EF02LP01',
        descricao: 'Utilizar, ao produzir o texto, grafia correta de palavras conhecidas ou com estruturas sil√°bicas j√° dominadas, letras mai√∫sculas em in√≠cio de frases e em substantivos pr√≥prios, segmenta√ß√£o entre as palavras, ponto final, ponto de interroga√ß√£o e ponto de exclama√ß√£o.',
        programaEnsinoId: port2ano.id,
        ordem: 1,
        competencia: 'Dominar conven√ß√µes da escrita',
        habilidade: 'Ortografia e pontua√ß√£o b√°sica',
      },
      {
        codigoBNCC: 'EF02LP02',
        descricao: 'Segmentar palavras em s√≠labas e remover e substituir s√≠labas iniciais, mediais ou finais para criar novas palavras.',
        programaEnsinoId: port2ano.id,
        ordem: 2,
        competencia: 'Desenvolver consci√™ncia fonol√≥gica avan√ßada',
        habilidade: 'Manipula√ß√£o de s√≠labas',
      },
      {
        codigoBNCC: 'EF02LP03',
        descricao: 'Ler e escrever palavras com correspond√™ncias regulares diretas entre letras e fonemas (f, v, t, d, p, b) e correspond√™ncias regulares contextuais (c e q; e e o, em posi√ß√£o √°tona em final de palavra).',
        programaEnsinoId: port2ano.id,
        ordem: 3,
        competencia: 'Consolidar o sistema alfab√©tico',
        habilidade: 'Correspond√™ncias grafema-fonema',
      },
    );
  }

  // ============================================
  // MATEM√ÅTICA - 2¬∫ ANO
  // ============================================
  const mat2ano = programas.find(p => p.codigo === 'MAT-2ANO-2025');
  if (mat2ano) {
    console.log('üìù Criando objetivos de Matem√°tica - 2¬∫ Ano...');
    objetivosData.push(
      {
        codigoBNCC: 'EF02MA01',
        descricao: 'Comparar e ordenar n√∫meros naturais (at√© a ordem de centenas) pela compreens√£o de caracter√≠sticas do sistema de numera√ß√£o decimal (valor posicional e fun√ß√£o do zero).',
        programaEnsinoId: mat2ano.id,
        ordem: 1,
        competencia: 'Compreender o valor posicional',
        habilidade: 'Sistema de numera√ß√£o decimal',
      },
      {
        codigoBNCC: 'EF02MA02',
        descricao: 'Fazer estimativas por meio de estrat√©gias diversas a respeito da quantidade de objetos de cole√ß√µes e registrar o resultado da contagem desses objetos (at√© 1000 unidades).',
        programaEnsinoId: mat2ano.id,
        ordem: 2,
        competencia: 'Desenvolver estimativa e contagem',
        habilidade: 'Estimativa e quantifica√ß√£o',
      },
      {
        codigoBNCC: 'EF02MA03',
        descricao: 'Comparar quantidades de objetos de dois conjuntos, por estimativa e/ou por correspond√™ncia (um a um, dois a dois, entre outros), para indicar "tem mais", "tem menos" ou "tem a mesma quantidade", indicando, quando for o caso, quantos a mais e quantos a menos.',
        programaEnsinoId: mat2ano.id,
        ordem: 3,
        competencia: 'Estabelecer rela√ß√µes num√©ricas',
        habilidade: 'Compara√ß√£o quantitativa',
      },
    );
  }

  // Criar objetivos no banco
  console.log('\nüíæ Salvando objetivos no banco de dados...');
  let criados = 0;
  let atualizados = 0;

  for (const objetivoData of objetivosData) {
    const existing = await prisma.objetivoAprendizagem.findUnique({
      where: { codigoBNCC: objetivoData.codigoBNCC },
    });

    if (existing) {
      await prisma.objetivoAprendizagem.update({
        where: { codigoBNCC: objetivoData.codigoBNCC },
        data: objetivoData,
      });
      atualizados++;
    } else {
      await prisma.objetivoAprendizagem.create({
        data: objetivoData,
      });
      criados++;
    }
  }

  console.log(`‚úÖ ${criados} objetivos criados`);
  console.log(`üîÑ ${atualizados} objetivos atualizados`);
  console.log(`\nüìä Total de objetivos: ${objetivosData.length}`);
  console.log('\n‚ú® Seed de Objetivos de Aprendizagem conclu√≠do com sucesso!');
}

main()
  .catch((e) => {
    console.error('‚ùå Erro no seed:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
